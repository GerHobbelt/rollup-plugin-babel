{"version":3,"file":"rollup-plugin-babel.esm.js","sources":["../src/constants.js","../src/preflightCheck.js","../src/helperPlugin.js","../src/utils.js","../src/index.js"],"sourcesContent":["export const INLINE = {};\r\nexport const RUNTIME = {};\r\nexport const EXTERNAL = {};\r\n\r\n// NOTE: DO NOT REMOVE the null character `\\0` as it may be used by other plugins\r\n// e.g. https://github.com/rollup/rollup-plugin-node-resolve/blob/313a3e32f432f9eb18cc4c231cc7aac6df317a51/src/index.js#L74\r\nexport const HELPERS = '\\0rollupPluginBabelHelpers';\r\n","import { join } from 'path';\r\nimport { transform } from '@gerhobbelt/babel-core';\r\nimport { INLINE, RUNTIME, EXTERNAL } from './constants.js';\r\n\r\nconst MODULE_ERROR =\r\n\t'Rollup requires that your Babel configuration keeps ES6 module syntax intact. ' +\r\n\t'Unfortunately it looks like your configuration specifies a module transformer ' +\r\n\t'to replace ES6 modules with another module format. To continue you have to disable it.' +\r\n\t'\\n\\n' +\r\n\t'Most commonly it\\'s a CommonJS transform added by @babel/preset-env - ' +\r\n\t'in such case you should disable it by adding `modules: false` option to that preset ' +\r\n\t'(described in more detail here - https://github.com/rollup/rollup-plugin-babel#modules ).';\r\n\r\nconst UNEXPECTED_ERROR =\r\n\t'An unexpected situation arose. Please raise an issue at ' +\r\n\t'https://github.com/rollup/rollup-plugin-babel/issues. Thanks!';\r\n\r\nfunction fallbackClassTransform () {\r\n\treturn {\r\n\t\tvisitor: {\r\n\t\t\tClassDeclaration (path, state) {\r\n\t\t\t\tpath.replaceWith(path, state.file.addHelper('inherits'));\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n}\r\n\r\nexport default function createPreflightCheck () {\r\n\tlet preflightCheckResults = {};\r\n\r\n\treturn ( ctx, options, dir ) => {\r\n\t\tif ( !preflightCheckResults[ dir ] ) {\r\n\t\t\tlet helpers;\r\n\r\n\t\t\toptions = Object.assign( {}, options );\r\n\t\t\tdelete options.only;\r\n\t\t\tdelete options.ignore;\r\n\r\n\t\t\toptions.filename = join( dir, 'x.js' );\r\n\r\n\t\t\tconst inputCode = 'class Foo extends Bar {};\\nexport default Foo;';\r\n\t\t\tlet check = transform( inputCode, options ).code;\r\n\r\n\t\t\tif ( ~check.indexOf('class ') ) {\r\n\t\t\t\toptions.plugins = (options.plugins || []).concat( fallbackClassTransform );\r\n\t\t\t\tcheck = transform( inputCode, options ).code;\r\n\t\t\t}\r\n\r\n\t\t\tif (\r\n\t\t\t\t!~check.indexOf( 'export default' ) &&\r\n\t\t\t\t!~check.indexOf( 'export default Foo' ) &&\r\n\t\t\t\t!~check.indexOf( 'export { Foo as default }' )\r\n\t\t\t) {\r\n\t\t\t\tctx.error( MODULE_ERROR );\r\n\t\t\t}\r\n\r\n\t\t\tif ( check.match( /\\/helpers\\/(esm\\/)?inherits/ ) ) helpers = RUNTIME;\r\n\t\t\telse if ( ~check.indexOf( 'function _inherits' ) ) helpers = INLINE;\r\n\t\t\telse if ( ~check.indexOf( 'babelHelpers' ) ) helpers = EXTERNAL;\r\n\t\t\telse {\r\n\t\t\t\tctx.error( UNEXPECTED_ERROR );\r\n\t\t\t}\r\n\r\n\t\t\tpreflightCheckResults[ dir ] = helpers;\r\n\t\t}\r\n\r\n\t\treturn preflightCheckResults[ dir ];\r\n\t};\r\n}\r\n","import { HELPERS } from './constants.js';\r\nimport { addNamed } from '@gerhobbelt/babel-helper-module-imports';\r\n\r\nexport default function importHelperPlugin () {\r\n\treturn {\r\n\t\tpre (file) {\r\n\t\t\tconst cachedHelpers = {};\r\n\t\t\tfile.set('helperGenerator', name => {\r\n\t\t\t\tif (cachedHelpers[name]) {\r\n\t\t\t\t\treturn cachedHelpers[name];\r\n\t\t\t\t}\r\n\t\t\t\treturn (cachedHelpers[name] = addNamed(file.path, name, HELPERS));\r\n\t\t\t});\r\n\t\t},\r\n\t};\r\n}\r\n\r\n","let warned = {};\r\nexport function warnOnce ( ctx, msg ) {\r\n\tif ( warned[ msg ] ) return;\r\n\twarned[ msg ] = true;\r\n\tctx.warn( msg );\r\n}\r\n","import { dirname } from 'path';\r\nimport { buildExternalHelpers, transform } from '@gerhobbelt/babel-core';\r\nimport { createFilter } from 'rollup-pluginutils';\r\nimport createPreflightCheck from './preflightCheck.js';\r\nimport helperPlugin from './helperPlugin.js';\r\nimport { warnOnce } from './utils.js';\r\nimport { RUNTIME, EXTERNAL, HELPERS } from './constants.js';\r\n\r\nconst unpackOptions = ({\r\n\t// rollup uses sourcemap, babel uses sourceMaps\r\n\t// just normalize them here so people don't have to worry about it\r\n\tsourcemap = true,\r\n\tsourcemaps = true,\r\n\tsourceMap = true,\r\n\tsourceMaps = true,\r\n\t...rest\r\n} = {}) => ({\r\n\tsourceMaps: sourcemap && sourcemaps && sourceMap && sourceMaps,\r\n\t...rest\r\n});\r\n\r\nexport default function babel ( options ) {\r\n\tconst {\r\n\t\texclude,\r\n\t\texternalHelpers,\r\n\t\texternalHelpersWhitelist,\r\n\t\tinclude,\r\n\t\truntimeHelpers,\r\n\t\t...babelOptions\r\n\t} = unpackOptions(options);\r\n\r\n\tconst filter = createFilter( include, exclude );\r\n\tconst preflightCheck = createPreflightCheck();\r\n\r\n\treturn {\r\n\t\tname: 'babel',\r\n\r\n\t\tresolveId ( id ) {\r\n\t\t\tif ( id === HELPERS ) return id;\r\n\t\t},\r\n\r\n\t\tload ( id ) {\r\n\t\t\tif ( id !== HELPERS ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\treturn buildExternalHelpers( externalHelpersWhitelist, 'module' );\r\n\t\t},\r\n\r\n\t\ttransform ( code, id ) {\r\n\t\t\tif ( !filter( id ) ) return null;\r\n\t\t\tif ( id === HELPERS ) return null;\r\n\r\n\t\t\tconst helpers = preflightCheck( this, babelOptions, dirname( id ) );\r\n\r\n\t\t\tif ( helpers === EXTERNAL && !externalHelpers ) {\r\n\t\t\t\twarnOnce( this, 'Using \"external-helpers\" plugin with rollup-plugin-babel is deprecated, as it now automatically deduplicates your Babel helpers.' );\r\n\t\t\t} else if ( helpers === RUNTIME && !runtimeHelpers ) {\r\n\t\t\t\tthis.error( 'Runtime helpers are not enabled. Either exclude the transform-runtime Babel plugin or pass the `runtimeHelpers: true` option. See https://github.com/rollup/rollup-plugin-babel#configuring-babel for more information' );\r\n\t\t\t}\r\n\r\n\t\t\tlet localOpts = Object.assign({ filename: id }, babelOptions);\r\n\r\n\t\t\tif ( helpers !== RUNTIME ) {\r\n\t\t\t\tlocalOpts = Object.assign({}, localOpts, { plugins: (localOpts.plugins || []).concat(helperPlugin) });\r\n\t\t\t}\r\n\r\n\t\t\tconst transformed = transform( code, localOpts );\r\n\r\n\t\t\tif (!transformed) {\r\n\t\t\t\treturn { code };\r\n\t\t\t}\r\n\r\n\t\t\treturn {\r\n\t\t\t\tcode: transformed.code,\r\n\t\t\t\tmap: transformed.map\r\n\t\t\t};\r\n\t\t}\r\n\t};\r\n}\r\n"],"names":["const","let","helperPlugin"],"mappings":"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"}